

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Introduction to the Dataset &mdash; Hadoop Traffic Analysis</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Hadoop Traffic Analysis" href="../index.html" />
    <link rel="next" title="Working with Multiple files" href="../1-MulitipleFiles/Multiples.html" />
    <link rel="prev" title="Hadoop Traffic Analysis" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../1-MulitipleFiles/Multiples.html" title="Working with Multiple files"
             accesskey="N">next</a></li>
        <li class="right" >
          <a href="../index.html" title="Hadoop Traffic Analysis"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Hadoop Traffic Analysis</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="introduction-to-the-dataset">
<h1>Introduction to the Dataset<a class="headerlink" href="#introduction-to-the-dataset" title="Permalink to this headline">¶</a></h1>
<div class="section" id="the-data">
<h2>The Data<a class="headerlink" href="#the-data" title="Permalink to this headline">¶</a></h2>
<p>The UK department of Transportation keeps detailed records
of all traffic incidents. Fortunately for us they made this
data available to the public in the form of three csv files
that contain information about the accidents, casualties,
and vehicles involved.</p>
<div class="topic">
<p class="topic-title first">System-dependent Alert</p>
<p>The path of the dataset shown below may not be the same on your WMR system.
It is correct for this WMR server:</p>
<p>selkie.macalester.edu/wmr</p>
</div>
<p>These files are located on wmr in the <tt class="docutils literal"><span class="pre">/shared/traffic</span></tt>
folder and are named <tt class="docutils literal"><span class="pre">Accidents7409.csv,</span>&nbsp; <span class="pre">Casualty7409.csv</span> <span class="pre">and</span>
<span class="pre">Vehicles7409.csv</span></tt> respectively.</p>
</div>
<div class="section" id="working-with-the-data">
<h2>Working with the Data<a class="headerlink" href="#working-with-the-data" title="Permalink to this headline">¶</a></h2>
<p>Each line in the files contains several fields separated by
commas, to access these values, it is necessary to call
<tt class="docutils literal"><span class="pre">key.split(',')</span></tt> (or the equivalent in whatever language
you&#8217;re using) to get an array of values. If you want, you
can turn these values into an object, however it&#8217;s faster
to simply refer to them by their index</p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="33%" />
<col width="33%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">index</th>
<th class="head">Accidents7409.csv</th>
<th class="head">Casualty7409.csv</th>
<th class="head">Vehicles7409.csv</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>0</td>
<td>Accident Index</td>
<td>Accident Index</td>
<td>Accident Index</td>
</tr>
<tr class="row-odd"><td>1</td>
<td>Location Easting OSGR</td>
<td>Vehicle Reference</td>
<td>Vehicle Reference</td>
</tr>
<tr class="row-even"><td>2</td>
<td>Location Northing OSGR</td>
<td>Casualty Reference</td>
<td>Vehicle Type</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>Longitude</td>
<td>Casualty Class</td>
<td>Towing/Articulation</td>
</tr>
<tr class="row-even"><td>4</td>
<td>Latitude</td>
<td>Sex of Casualty</td>
<td>Vehicle Maneuver</td>
</tr>
<tr class="row-odd"><td>5</td>
<td>Police Force</td>
<td>Age Band of Casualty</td>
<td>Vehicle Location Restricted Lane</td>
</tr>
<tr class="row-even"><td>6</td>
<td>Accident Severity</td>
<td>Casualty Severity</td>
<td>Junction Location</td>
</tr>
<tr class="row-odd"><td>7</td>
<td>Number of Vehicles</td>
<td>Pedestrian Location</td>
<td>Skidding/Overturning</td>
</tr>
<tr class="row-even"><td>8</td>
<td>Number of Casualties</td>
<td>Pedestrian Movement</td>
<td>Hit Object in Driveway</td>
</tr>
<tr class="row-odd"><td>9</td>
<td>Date</td>
<td>Car Passenger</td>
<td>Vehicle Leaving Driveway</td>
</tr>
<tr class="row-even"><td>10</td>
<td>Day of Week</td>
<td>Bus/Coach Passenger</td>
<td>Hit Object off Driveway</td>
</tr>
<tr class="row-odd"><td>11</td>
<td>Time</td>
<td>Pedestrian Road  Maintenance Worker</td>
<td>1st Point of Impact</td>
</tr>
<tr class="row-even"><td>12</td>
<td>Local Authority (District)</td>
<td>Casualty Type</td>
<td>Was Vehicle Left Hand Drive</td>
</tr>
<tr class="row-odd"><td>13</td>
<td>Local Authority (Highway)</td>
<td>Casualty Home Area Type</td>
<td>Journey Purpose of Driver</td>
</tr>
<tr class="row-even"><td>14</td>
<td>1st Road Class</td>
<td>&nbsp;</td>
<td>Sex of Driver</td>
</tr>
<tr class="row-odd"><td>15</td>
<td>1st Road Number</td>
<td>&nbsp;</td>
<td>Age Band of Driver</td>
</tr>
<tr class="row-even"><td>16</td>
<td>Road Type</td>
<td>&nbsp;</td>
<td>Engine Capacity</td>
</tr>
<tr class="row-odd"><td>17</td>
<td>Speed Limit</td>
<td>&nbsp;</td>
<td>Propulsion Code</td>
</tr>
<tr class="row-even"><td>18</td>
<td>Junction Detail</td>
<td>&nbsp;</td>
<td>Age of Vehicle</td>
</tr>
<tr class="row-odd"><td>19</td>
<td>Junction Control</td>
<td>&nbsp;</td>
<td>Driver IMD Decile</td>
</tr>
<tr class="row-even"><td>20</td>
<td>2nd Road Class</td>
<td>&nbsp;</td>
<td>Driver Home Area Type</td>
</tr>
<tr class="row-odd"><td>21</td>
<td>2nd Road Number</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>22</td>
<td>Pedestrian Crossing Human Control</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>23</td>
<td>Pedestrian Crossing Physical Facilities</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>24</td>
<td>Light Conditions</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>25</td>
<td>Weather Conditions</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>26</td>
<td>Road Surface Conditions</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>27</td>
<td>Special Conditions</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>28</td>
<td>Carriage Hazards</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>29</td>
<td>Urban or Rural Area</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>30</td>
<td>Did Police Officer Attend Scene</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>31</td>
<td>LSOA of Accident Location</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>Most of the values are determined by special codes which
which can be found in the pages of
<a class="reference download internal" href="../_downloads/Road-Accident-Safety-Data-Guide-1979-2004.xls"><tt class="xref download docutils literal"><span class="pre">this</span> <span class="pre">spreadsheet</span></tt></a></p>
</div>
<div class="section" id="example-job">
<h2>Example Job<a class="headerlink" href="#example-job" title="Permalink to this headline">¶</a></h2>
<p>Let&#8217;s use what we&#8217;ve learned to answer a quick question.
Between 1974 and 2004 were there more casualties per
incident in rural or urban accidents?</p>
<p>Our <a class="reference download internal" href="../_downloads/urbanOrRuralMapper.py"><tt class="xref download docutils literal"><span class="pre">mapper</span></tt></a> will need to emit a key
that represents whether the accident was rural or urban and the number
of casualties as the value.</p>
<p>Our <a class="reference download internal" href="../_downloads/averageReducer.py"><tt class="xref download docutils literal"><span class="pre">reducer</span></tt></a> will need to sum the
casualties for each type of accident and divide them by the total number
of accidents.</p>
<p>Given that the code that tells whether a crash was urban or
rural is stored at index 29 of the accident csv and the
number of casualties is stored at index 8 our code looks like
this:</p>
<div class="highlight-python"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">mapper</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
  <span class="n">casualties</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
  <span class="n">urbanOrRural</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">29</span><span class="p">]</span>
  <span class="n">Wmr</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">urbanOrRural</span><span class="p">,</span> <span class="n">casualties</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">reducer</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
  <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="n">Wmr</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">total</span> <span class="o">/</span> <span class="n">count</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Does this reducer look familiar?</p>
</div>
<p>Run this job on wmr using cluster path
<tt class="docutils literal"><span class="pre">/shared/traffic/Accidents7904.csv</span></tt> You should get the following
output:</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>1</td>
<td>1.2805146224316546</td>
</tr>
<tr class="row-even"><td>2</td>
<td>1.5105844913989401</td>
</tr>
<tr class="row-odd"><td>3</td>
<td>1.4071045576407506</td>
</tr>
<tr class="row-even"><td>-1</td>
<td>1.3062582787269292</td>
</tr>
</tbody>
</table>
<p>A quick glance at the spreadsheet reveals that 1 stands for
Urban, 2 for rural, and 3 for unallocated. -1 means that neither
was reported. It appears that on average rural accidents tend
to involve more casualties.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/CSInParallel200wide.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Introduction to the Dataset</a><ul>
<li><a class="reference internal" href="#the-data">The Data</a></li>
<li><a class="reference internal" href="#working-with-the-data">Working with the Data</a></li>
<li><a class="reference internal" href="#example-job">Example Job</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../index.html"
                        title="previous chapter">Hadoop Traffic Analysis</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../1-MulitipleFiles/Multiples.html"
                        title="next chapter">Working with Multiple files</a></p>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../1-MulitipleFiles/Multiples.html" title="Working with Multiple files"
             >next</a></li>
        <li class="right" >
          <a href="../index.html" title="Hadoop Traffic Analysis"
             >previous</a> |</li>
        <li><a href="../index.html">Hadoop Traffic Analysis</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>