<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Getting More Sophisticated &mdash; Spinlocks and Contention</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Spinlocks and Contention" href="../index.html" />
    <link rel="prev" title="Part Two: A Couple of Other Ideas" href="../part2/part2.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../part2/part2.html" title="Part Two: A Couple of Other Ideas"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Spinlocks and Contention</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="getting-more-sophisticated">
<h1>Getting More Sophisticated<a class="headerlink" href="#getting-more-sophisticated" title="Permalink to this headline">Â¶</a></h1>
<p>The spinlock constructions we&#8217;ve looked at some far provide first-come-first-served (FIFO) access with little contention, making them useful in many applications. In <a class="reference external" href="http://en.wikipedia.org/wiki/Real-time_computing">real-time systems</a>, however, threads may require the ability to <em>abort</em>, canceling a pending request to acquire a lock in order to meet some other real-time deadline. Example reasons for giving up waiting for a lock could include a tiemout or a database transaction aborted by the user. Let&#8217;s look at implementing the option to abort on the locks we&#8217;ve examined so far:</p>
<p>Aborting a <span class="uline">backoff lock</span> request is trivial: if the request takes too long, simply return from the <tt class="docutils literal"><span class="pre">lock()</span></tt> method. The lock&#8217;s state is unaffected by any thread&#8217;s abort. A nice property of this lock is that the abort itself is immediate: it is wait-free, requiring only a constant number of steps, and there is no cleanup.</p>
<p>The <span class="uline">queue lock</span> is a little trickier, though: if we simply quit, the next thread in line will starve.</p>
<p>Under normal circumstances, recall, the queue lock works like this:</p>
<a class="reference internal image-reference" href="../_images/normalqueue.gif"><img alt="normal queue behavior." class="align-center" src="../_images/normalqueue.gif" style="width: 300.0px; height: 126.4px;" /></a>
<p>However, if we try to have a node in the middle abort, the subsequent threads run into problems:</p>
<a class="reference internal image-reference" href="../_images/abortqueue.gif"><img alt="queue with an aborting node" class="align-center" src="../_images/abortqueue.gif" style="width: 300.0px; height: 126.4px;" /></a>
<p>Instead, we need a graceful way out. Removing a node in a wait-free manner from the middle of the list is difficult if we want that thread to reuse its own node, though. Instead, the aborting thread marks the node so that the successor in the list will reuse the abandoned node and wait for that node&#8217;s predecessor. Let&#8217;s go through it one step at a time:</p>
<a class="reference internal image-reference" href="../_images/clhabort1.png"><img alt="queue with an aborting node" class="align-center" src="../_images/clhabort1.png" style="width: 238.8px; height: 146.8px;" /></a>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/CSInParallel200wide.png" alt="Logo"/>
            </a></p>
  <h4>Previous topic</h4>
  <p class="topless"><a href="../part2/part2.html"
                        title="previous chapter">Part Two: A Couple of Other Ideas</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../part2/part2.html" title="Part Two: A Couple of Other Ideas"
             >previous</a> |</li>
        <li><a href="../index.html">Spinlocks and Contention</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>