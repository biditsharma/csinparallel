

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Core Functions &mdash; Pandemic Exemplar (for those with some experience)</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="Pandemic Exemplar (for those with some experience)" href="../index.html" />
    <link rel="next" title="CUDA Functions" href="../5-CudaFunctions/cudafunctions.html" />
    <link rel="prev" title="MPI Functions" href="../4-MPIFunctions/mpifunctions.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../5-CudaFunctions/cudafunctions.html" title="CUDA Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../4-MPIFunctions/mpifunctions.html" title="MPI Functions"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Pandemic Exemplar (for those with some experience)</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="core-functions">
<h1>Core Functions<a class="headerlink" href="#core-functions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="move">
<h2>move<a class="headerlink" href="#move" title="Permalink to this headline">¶</a></h2>
<p>If the person is not dead, then</p>
<div class="highlight-c"><div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">!=</span> <span class="n">DEAD</span><span class="p">)</span>
</pre></div>
</div>
<p>First, The thread randomly picks whether the person moves left or right
or does not move in the x dimension.</p>
<p>The code uses (random() % 3) - 1; to achieve this. (random() % 3)
returns either 0, 1, or 2. Subtracting 1 from this produces -1, 0, or 1.
This means the person can move to the right, stay in place (0), or move
to the left (-1).</p>
<p>The thread randomly picks whether the person moves up or down or
does not move in the y dimension. This is similar to movement in x dimension.</p>
<p>Next, If the person will remain in the bounds of the environment after
moving, then</p>
<p>We check this by making sure the person’s x location is greater than or
equal to 0 and less than the width of the environment and that the
person’s y location is greater than or equal to 0 and less than the
height of the environment. In the code, it looks like this:</p>
<div class="highlight-c"><div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span> <span class="p">(</span><span class="n">our_x_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> 
                    <span class="o">+</span> <span class="n">my_x_move_direction</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="n">our_x_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> 
                    <span class="o">+</span> <span class="n">my_x_move_direction</span> <span class="o">&lt;</span> <span class="n">environment_width</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="n">our_y_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> 
                    <span class="o">+</span> <span class="n">my_y_move_direction</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="n">our_y_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> 
                    <span class="o">+</span> <span class="n">my_y_move_direction</span> <span class="o">&lt;</span> <span class="n">environment_height</span><span class="p">)</span> <span class="p">)</span>
</pre></div>
</div>
<p>Finally, The thread moves the person</p>
<div class="figure align-center">
<img alt="image" src="../_images/img-20.png" />
</div>
<p>The thread is able to achieve this by simply changing values in the
<strong>our_x_locations</strong> and <strong>our_y_locations</strong> arrays.</p>
</div>
<div class="section" id="susceptible">
<h2>susceptible<a class="headerlink" href="#susceptible" title="Permalink to this headline">¶</a></h2>
<p>For each of the process’s people, each process spawns threads to do the following</p>
<div class="highlight-c"><div class="highlight"><pre>    <span class="k">for</span><span class="p">(</span><span class="n">my_current_person_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">my_current_person_id</span> 
          <span class="o">&lt;=</span> <span class="n">our</span><span class="o">-&gt;</span><span class="n">our_number_of_people</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">my_current_person_id</span><span class="o">++</span><span class="p">)</span>
</pre></div>
</div>
<p>If the person is susceptible,</p>
<div class="highlight-c"><div class="highlight"><pre>       <span class="k">if</span><span class="p">(</span><span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">SUSCEPTIBLE</span><span class="p">)</span>
</pre></div>
</div>
<p>For each of the infected people (received earlier from all processes) or until the number of infected people nearby is 1, the thread does the following</p>
<div class="highlight-c"><div class="highlight"><pre>            <span class="k">for</span><span class="p">(</span><span class="n">my_person2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">my_person2</span> <span class="o">&lt;=</span> <span class="n">total_num_infected</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="o">&amp;&amp;</span> <span class="n">my_num_infected_nearby</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">;</span> <span class="n">my_person2</span><span class="o">++</span><span class="p">)</span>
</pre></div>
</div>
<p>If person 1 is within the infection radius, then</p>
<div class="highlight-c"><div class="highlight"><pre>                <span class="k">if</span><span class="p">((</span><span class="n">our_x_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> 
                    <span class="o">&gt;</span> <span class="n">their_infected_x_locations</span><span class="p">[</span><span class="n">my_person2</span><span class="p">]</span> <span class="o">-</span> <span class="n">infection_radius</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                   <span class="p">(</span><span class="n">our_x_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> 
                    <span class="o">&lt;</span> <span class="n">their_infected_x_locations</span><span class="p">[</span><span class="n">my_person2</span><span class="p">]</span> <span class="o">+</span> <span class="n">infection_radius</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                   <span class="p">(</span><span class="n">our_y_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span>
                    <span class="o">&gt;</span> <span class="n">their_infected_y_locations</span><span class="p">[</span><span class="n">my_person2</span><span class="p">]</span> <span class="o">-</span> <span class="n">infection_radius</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                   <span class="p">(</span><span class="n">our_y_locations</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span>
                    <span class="o">&lt;</span> <span class="n">their_infected_y_locations</span><span class="p">[</span><span class="n">my_person2</span><span class="p">]</span> <span class="o">+</span> <span class="n">infection_radius</span><span class="p">))</span>
</pre></div>
</div>
<p>The thread increments the number of infected people nearby</p>
<div class="highlight-c"><div class="highlight"><pre>                    <span class="n">my_num_infected_nearby</span><span class="o">++</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="image" src="../_images/img-21.png" />
</div>
<p>This is where a large chunk of the algorithm’s computation occurs. Each
susceptible person must be computed with each infected person to
determine how many infected people are nearby each person. Two nested
loops means many computations. In this step, the computation is fairly
simple, however. The thread simply increments the
<strong>my_num_infected_nearby</strong> variable.</p>
<p>Note in the code that if the number of infected nearby is greater than
or equal to 1 and we have <strong>SHOW_RESULTS</strong> enabled, we increment the
<strong>our_num_infection_attempts</strong> variable. This helps us keep track of the
number of attempted infections, which will help us calculate the actual
contagiousness of the disease at the end of the simulation.</p>
<p>If there is at least one infected person nearby, and a random
number less than 100 is less than or equal to the contagiousness factor,
then</p>
<div class="highlight-c"><div class="highlight"><pre>            <span class="k">if</span><span class="p">(</span><span class="n">my_num_infected_nearby</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">random</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> 
                <span class="o">&lt;=</span> <span class="n">contagiousness_factor</span><span class="p">)</span>
</pre></div>
</div>
<p>Recall that the contagiousness factor is the likelihood that the disease
will be spread. We measure this as a number less than 100. For example,
if there is a 30% chance of contagiousness, we use 30 as the value of
the contagiousness factor. To figure out if the disease is spread for
any given interaction of people, we find a random number less than 100
and check if it is less than or equal to the contagiousness factor,
because this will be equivalent to calculating the odds of actually
spreading the disease (e.g. there is a 30% chance of spreading the
disease and also a 30% chance that a random number less than 100 will be
less than or equal to 30).</p>
<p>The thread changes person1’s state to infected</p>
<div class="highlight-c"><div class="highlight"><pre>                <span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">INFECTED</span><span class="p">;</span>
</pre></div>
</div>
<p>The thread updates the counters</p>
<div class="highlight-c"><div class="highlight"><pre>                <span class="n">our_num_infected_local</span><span class="o">++</span><span class="p">;</span>
                <span class="n">our_num_susceptible_local</span><span class="o">--</span><span class="p">;</span>

<span class="cp">                #ifdef SHOW_RESULTS</span>
                <span class="n">our_num_infections_local</span><span class="o">++</span><span class="p">;</span>
<span class="cp">                #endif</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="image" src="../_images/img-22.png" />
</div>
<p>These steps are as simple as updating the <strong>our_states</strong> array by
<strong>our_states[my_current_person_id] = INFECTED</strong>, incrementing the
<strong>our_num_infected</strong> variable, and decrementing the <strong>our_num_susceptible</strong>
variable.</p>
<p>Note in the code that if the infection succeeds and we have
<strong>SHOW_RESULTS</strong> enabled, we increment the <strong>our_num_infections variable</strong>.
This helps us keep track of the actual number of infections, which will
help us calculate the actual contagiousness of the disease at the end of
the simulation.</p>
</div>
<div class="section" id="infected">
<h2>infected<a class="headerlink" href="#infected" title="Permalink to this headline">¶</a></h2>
<p>For each of the process’s people, each process spawns threads to do the following</p>
<div class="highlight-c"><div class="highlight"><pre>    <span class="k">for</span><span class="p">(</span><span class="n">my_current_person_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">my_current_person_id</span> 
        <span class="o">&lt;=</span> <span class="n">our</span><span class="o">-&gt;</span><span class="n">our_number_of_people</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">my_current_person_id</span><span class="o">++</span><span class="p">)</span>
</pre></div>
</div>
<p>If the person is infected and has been for the full duration of the disease, then</p>
<div class="highlight-c"><div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">INFECTED</span>
            <span class="o">&amp;&amp;</span> <span class="n">our_num_days_infected</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">duration_of_disease</span><span class="p">)</span>
</pre></div>
</div>
<p>Note in the code that if we have <strong>SHOW_RESULTS</strong> enabled, we increment the
<strong>our_num_recovery_attempts</strong> variable. This helps us keep track of the
number of attempted recoveries, which will help us calculate the actual
deadliness of the disease at the end of the simulation.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">            #ifdef SHOW_RESULTS</span>
                <span class="n">our_num_recovery_attempts_local</span><span class="o">++</span><span class="p">;</span>
<span class="cp">            #endif</span>
</pre></div>
</div>
<p>If a random number less than 100 is less than the deadliness factor, then</p>
<div class="highlight-c"><div class="highlight"><pre>            <span class="k">if</span><span class="p">((</span><span class="n">random</span><span class="p">()</span> <span class="o">%</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">deadliness_factor</span><span class="p">)</span>
</pre></div>
</div>
<p>The thread changes the person’s state to dead</p>
<div class="highlight-c"><div class="highlight"><pre>                <span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">DEAD</span><span class="p">;</span>
</pre></div>
</div>
<p>The thread updates the counters</p>
<div class="highlight-c"><div class="highlight"><pre>                <span class="n">our_num_dead_local</span><span class="o">++</span><span class="p">;</span>
                <span class="n">our_num_infected_local</span><span class="o">--</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="image" src="../_images/img-23.png" />
</div>
<p>This step is effectively the same as function susceptible, considering deadliness
instead of contagiousness. The difference here is the following step:</p>
<p>Otherwise,</p>
<p>The thread changes the person’s state to immune</p>
<div class="highlight-c"><div class="highlight"><pre>                <span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMMUNE</span><span class="p">;</span>
</pre></div>
</div>
<p>The thread updates the counters</p>
<div class="highlight-c"><div class="highlight"><pre>                <span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">IMMUNE</span><span class="p">;</span>
                <span class="c1">// The thread updates the counters</span>
                <span class="n">our_num_immune_local</span><span class="o">++</span><span class="p">;</span>
                <span class="n">our_num_infected_local</span><span class="o">--</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="image" src="../_images/img-24.png" />
</div>
<p>If deadliness fails, then immunity succeeds.</p>
<p>Note in the code that if the person dies and we have <strong>SHOW_RESULTS</strong>
enabled, we increment the <strong>our_num_deaths</strong> variable. This helps us keep
track of the actual number of deaths, which will help us calculate the
actual deadliness of the disease at the end of the simulation.</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">                #ifdef SHOW_RESULTS</span>
                    <span class="n">our_num_deaths_local</span><span class="o">++</span><span class="p">;</span>
<span class="cp">                #endif</span>
</pre></div>
</div>
</div>
<div class="section" id="updatedays">
<h2>updateDays<a class="headerlink" href="#updatedays" title="Permalink to this headline">¶</a></h2>
<p>For each of the process’s people, each process spawns threads to do the following</p>
<div class="highlight-c"><div class="highlight"><pre>    <span class="k">for</span><span class="p">(</span><span class="n">my_current_person_id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">my_current_person_id</span> 
        <span class="o">&lt;=</span> <span class="n">our</span><span class="o">-&gt;</span><span class="n">our_number_of_people</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">my_current_person_id</span><span class="o">++</span><span class="p">)</span>
</pre></div>
</div>
<p>If the person is infected, then</p>
<div class="highlight-c"><div class="highlight"><pre>        <span class="k">if</span><span class="p">(</span><span class="n">our_states</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span> <span class="o">==</span> <span class="n">INFECTED</span><span class="p">)</span>
</pre></div>
</div>
<p>Increment the number of days the person has been infected</p>
<div class="highlight-c"><div class="highlight"><pre>            <span class="n">our_num_days_infected</span><span class="p">[</span><span class="n">my_current_person_id</span><span class="p">]</span><span class="o">++</span><span class="p">;</span>
</pre></div>
</div>
<div class="figure align-center">
<img alt="image" src="../_images/img-25.png" />
</div>
<p>This is achieved by incrementing each member of the
<strong>our_num_days_infected</strong> array, which can be done as follows:
<strong>our_num_days_infected[my_current_person_id]++</strong></p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/CSInParallel200wide.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Core Functions</a><ul>
<li><a class="reference internal" href="#move">move</a></li>
<li><a class="reference internal" href="#susceptible">susceptible</a></li>
<li><a class="reference internal" href="#infected">infected</a></li>
<li><a class="reference internal" href="#updatedays">updateDays</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../4-MPIFunctions/mpifunctions.html"
                        title="previous chapter">MPI Functions</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../5-CudaFunctions/cudafunctions.html"
                        title="next chapter">CUDA Functions</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../5-CudaFunctions/cudafunctions.html" title="CUDA Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="../4-MPIFunctions/mpifunctions.html" title="MPI Functions"
             >previous</a> |</li>
        <li><a href="../index.html">Pandemic Exemplar (for those with some experience)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>