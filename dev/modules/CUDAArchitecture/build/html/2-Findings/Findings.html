<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Choosing the right Dimensions &mdash; Optimizing for CUDA Architecture</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Optimizing for CUDA Architecture" href="../index.html" />
    <link rel="prev" title="Mandelbrot Test Code" href="../1-Mandelbrot/Mandelbrot.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../1-Mandelbrot/Mandelbrot.html" title="Mandelbrot Test Code"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Optimizing for CUDA Architecture</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="choosing-the-right-dimensions">
<h1>Choosing the right Dimensions<a class="headerlink" href="#choosing-the-right-dimensions" title="Permalink to this headline">¶</a></h1>
<p>One of the most important elements of CUDA programming is
choosing the right grid and block dimensions for the
problem size. However it&#8217;s not always clear which dimensions
to choose so we created an expiriment to answer the following
question: What effect do the grid and block dimensions have
on execution times?</p>
<p>To answer this questions, we wrote a
<a class="reference download internal" href="../_downloads/testMandelbrot.sh"><tt class="xref download docutils literal"><span class="pre">script</span></tt></a> to run our mandelbrot code
for every
block size between 1 and 512 and every number of threads
per block between 1 and 512 which produced 262,144 data
points. We chose these ranges because our picture is
512x512 so each thread will calculate the value of at least
one pixel.</p>
<p>The device we ran the tests on was a Jetson TK1 which has
one Streaming Multiprocessor with 192 CUDA cores. To ensure
that our code was the only thing running on the GPU, we
first disabled the X server.</p>
<div class="section" id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this headline">¶</a></h2>
<p>This is a 3D graph of our <a class="reference download internal" href="../_downloads/results.txt"><tt class="xref download docutils literal"><span class="pre">results</span></tt></a>
where the z axis is the
log<sub>2</sub>(time) we took the log so that all results
fit neatly on the graph.</p>
<div class="align-center figure">
<a class="reference internal image-reference" href="../_images/MediumPlot.png"><img alt="Execution time" src="../_images/MediumPlot.png" style="width: 768px; height: 510px;" /></a>
</div>
<p>There are a number of interesting things to note about this
graph:</p>
<ul class="simple">
<li>Trials with one block and many threads are faster than
trials with many blocks of one thread each.</li>
<li>There are horizontal lines indicating a spike in execution
time after every 32 threads per block</li>
<li>512 threads per 512 blocks was the fastest execution time</li>
<li>There are convex lines running through the middle of the
graph</li>
</ul>
<p>Each of these observations relates directly to CUDA&#8217;s
architecture or the specifics of the code.</p>
<p>Many threads in 1 block is always faster than many blocks of one thread because only one block at a time can be run
on any given CUDA core, therefore when the blocks are divided
into warps, there is only one thread per core versus 32
threads per core.</p>
<p>Warp size also explains the horizontal lines every
32 threads per block. When block are are evenly divisible
into warps of 32, each block uses the full resources of the
CUDA cores on which it is run, but when there are (32 * x) +
1 threads, every block uses
a full CUDA core to run only one thread, which accounts for
the slowdown.</p>
<p>512x512 is the fastest execution time even though the GPU
can&#8217;t run that many threads at a time. This is because
it is inexpensive to create threads on a CUDA card.
cards and having one pixel per thread allows the GPU to
most efficently schedule warps as the CUDA cores become free.</p>
<p>The convex lines appear for a few different reasons. The
first has to do with our code. When the picture is evenly
divisible by the total number of threads and blocks, each
thread performs the same amount of work so the CUDA cores
don&#8217;t have to wait for threads calculating extra pixels.
Second, when block and grid dimensions are about roughly
equal, the block and warp schedulers share the work of
dividing the threads.</p>
</div>
<div class="section" id="cuda-best-practices">
<h2>CUDA best practices<a class="headerlink" href="#cuda-best-practices" title="Permalink to this headline">¶</a></h2>
<p>From these results we can draw up a list of best practices:</p>
<ol class="arabic simple">
<li>Try to make the number of threads per block a multiple of 32</li>
<li>Keep the number of threads per block and the number of blocks as close to equal as you can without violating the first tip</li>
<li>Keep the amount of work each thread does constant, it&#8217;s inefficent to have one thread perform calculations for two pixels while the rest only calculate one.</li>
<li>When in doubt use more threads not less, creating threads is inexpensive.</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/CSInParallel200wide.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Choosing the right Dimensions</a><ul>
<li><a class="reference internal" href="#results">Results</a></li>
<li><a class="reference internal" href="#cuda-best-practices">CUDA best practices</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../1-Mandelbrot/Mandelbrot.html"
                        title="previous chapter">Mandelbrot Test Code</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../1-Mandelbrot/Mandelbrot.html" title="Mandelbrot Test Code"
             >previous</a> |</li>
        <li><a href="../index.html">Optimizing for CUDA Architecture</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 Unported License.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>